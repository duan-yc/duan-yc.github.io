---
layout: post
title: "redis学习"
subtitle: "redis学习"
author: "DYC"
header-img: "img/post-bg-linux.jpg"
header-mask: 0.3
catalog: true
tags:
  - java
---

redis学习

#### redis基础

###### NoSQL

**非关系型数据库**

1. 结构化与非结构化

   传统关系型数据库是结构化数据，每张表都有严格的约束信息，插入数据必须遵守这些约束

   而NoSQL则对数据库格式没有严格约束，往往形式松散，比如像键值型数据库、文档型等

2. 关联与非关联

   传统数据库的表与表之间往往存在关联，比如使用外键等

   非关系型数据库不存在关联关系，要维护关系要么靠代码中的业务逻辑，要么靠数据之间的耦合

3. 查询方式

   SQL有固定的语法查询格式，有统一标准

   不同的非关系数据库查询语法差异极大

   ![image-20240514110537755](https://cdn.jsdelivr.net/gh/ddyycc123/imageloader@main/image-20240514110537755.png)

4. 事务

   关系型数据库支持事务，支持ACID原则，非关系型数据库不支持事务

5. 扩展性

   关系型数据库集群模式一般是主从，主从数据一致，起到数据备份的作用，称为垂直扩展

   非关系型数据库将数据拆分，存储在不同机器上，可以保存海量数据，称为水平扩展

###### redis安装

1. 将安装包放到一个位置，可以是/usr/local/src 目录

2. 解压

   ```shell
   tar -xzf redis-6.2.6.tar.gz
   ```

3. 进入解压目录

   ```shell
   cd redis-6.2.6
   ```

4. 运行编译

   ```shell
   make && make install
   ```

5. 设置后台配置

   如果文件是只读模式，可以使用sudo vi的模式进行修改

   在配置文件中想找某个关键词，可以在esc模式下，用：/keyword进行检索

   ```properties
   # 允许访问的地址，默认是127.0.0.1，会导致只能在本地访问。修改为0.0.0.0则可以在任意IP访问，生产环境不要设置为0.0.0.0
   bind 0.0.0.0
   # 守护进程，修改为yes后即可后台运行
   daemonize yes 
   # 密码，设置后访问Redis必须输入密码
   requirepass 123321
   # 监听的端口
   port 6379
   # 工作目录，默认是当前目录，也就是运行redis-server时的命令，日志、持久化等文件会保存在这个目录
   dir .
   # 数据库数量，设置为1，代表只使用1个库，默认有16个库，编号0~15
   databases 1
   # 设置redis能够使用的最大内存
   maxmemory 512mb
   # 日志文件，默认为空，不记录日志，可以指定日志文件名
   logfile "redis.log"
   ```

   ```shell
   # 进入redis安装目录 
   cd /usr/local/src/redis-6.2.6
   # 启动
   redis-server redis.conf
   ```

6. 运行

   ```shell
   redis-server
   ```

7. 关闭redis

   ```shell
   #找到进程号，接着kill掉进程
   lsof -i :6379
   #或者
   ps aux | grep redis-server
   #接着
   kill -9 pid
   ```

8. 连接客户端

   Redis安装完成后就自带了命令行客户端：redis-cli，使用方式如下：

   ```shell
   redis-cli [options] [commonds]
   ```

   其中常见的options有：

   - `-h 127.0.0.1`：指定要连接的redis节点的IP地址，默认是127.0.0.1
   - `-p 6379`：指定要连接的redis节点的端口，默认是6379
   - `-a 123321`：指定redis的访问密码 

   其中的commonds就是Redis的操作命令，例如：

   - `ping`：与redis服务端做心跳测试，服务端正常会返回`pong`

   ```
   redis-cli -h 127.0.0.1 -p 6379 -a 123321
   ```

查找redis的安装目录

```shell
which redis-server
```

查找目标端口正在运行的进程

```shell
#找到进程号，接着kill掉进程
lsof -i :6379
```

如果使用可视化客户端，远程连接失败的话，可以考虑设置防火墙

```shell
firewall-cmd --zone=public --add-port=6379/tcp --permanent
```

###### redis数据类型

**String类型**

String类型，其value是字符串，不过根据字符串的格式不同，又可以分为3类：

- string：普通字符串
- int：整数类型，可以做自增、自减操作
- float：浮点类型，可以做自增、自减操作

不管是哪种格式，**底层都是字节数组形式存储**，只不过是编码方式不同。字符串类型的最大空间不能超过**512m**.

**key的结构**

由于Redis没有表的概念，为了能更好的区分不同类型的key（比如两个物品id都是1），可以对key**添加前缀进行区分**

Redis的key允许有多个单词形成层级结构，多个单词之间用':'隔开，格式如下：

```
	项目名:业务名:类型:id
```

例如项目名称叫 heima，有user和product两种不同类型的数据，我们可以这样定义key：

- user相关的key：**heima:user:1**

- product相关的key：**heima:product:1**

如果Value是一个Java对象，例如一个User对象，则可以将对象序列化为JSON字符串后存储：

| **KEY**         | **VALUE**                                  |
| --------------- | ------------------------------------------ |
| heima:user:1    | {"id":1,  "name": "Jack", "age": 21}       |
| heima:product:1 | {"id":1,  "name": "小米11", "price": 4999} |

**Hash类型**

考虑到对string类型进行修改时，其value类型修改起来只能覆盖，所以使用hash将对象中的每个字段独立存储，可以针对单个字段做CRUD

**hash类型修改value时相对于string更灵活**

![image-20240515111912754](https://cdn.jsdelivr.net/gh/ddyycc123/imageloader@main/image-20240515111912754.png)

**List类型**

类似于**双向链表的结构，**既支持正向检索，也支持反向检索

**保存对先后顺序有要求的结构，常用来存储一个有序数据**，例如：朋友圈点赞列表，评论列表等。

阻塞式获取（BLPOP和BRPOP）：**会设置一个等待时间**，在这个时间内有的话就返回。与LPOP和RPOP类似，只不过在没有元素时等待指定时间，而不是直接返回nil

**Set类型**